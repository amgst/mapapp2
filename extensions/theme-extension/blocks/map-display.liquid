{% comment %}
  Simple Map Display App Block
  This block displays a basic interactive map
{% endcomment %}

<div class="map-display-block" id="map-display-{{ block.id }}">
  {% if block.settings.title != blank %}
    <h2 class="map-title">{{ block.settings.title }}</h2>
  {% endif %}
  
  {% if block.settings.description != blank %}
    <p class="map-description">{{ block.settings.description }}</p>
  {% endif %}

  <div class="map-wrapper">
    <div id="simple-map-{{ block.id }}" class="simple-map" style="height: {{ block.settings.height }}px;"></div>
  </div>
</div>

<script>
  window.mapDisplayData = window.mapDisplayData || {};
  window.mapDisplayData['{{ block.id }}'] = {
    lat: {{ block.settings.latitude | default: 40.7128 }},
    lng: {{ block.settings.longitude | default: -74.0060 }},
    zoom: {{ block.settings.zoom | default: 12 }},
    apiKey: '{{ block.settings.google_maps_api_key }}',
    markerTitle: '{{ block.settings.marker_title | escape }}'
  };

  function initSimpleMap(blockId) {
    const data = window.mapDisplayData[blockId];
    if (!data || !data.apiKey) {
      document.getElementById(`simple-map-${blockId}`).innerHTML = 
        '<div class="map-error">Google Maps API key required</div>';
      return;
    }

    const map = new google.maps.Map(document.getElementById(`simple-map-${blockId}`), {
      center: { lat: data.lat, lng: data.lng },
      zoom: data.zoom,
      mapTypeControl: {{ block.settings.show_map_type_control }},
      streetViewControl: {{ block.settings.show_street_view_control }},
      fullscreenControl: {{ block.settings.show_fullscreen_control }}
    });

    {% if block.settings.show_marker %}
    const marker = new google.maps.Marker({
      position: { lat: data.lat, lng: data.lng },
      map: map,
      title: data.markerTitle
    });

    {% if block.settings.marker_info != blank %}
    const infoWindow = new google.maps.InfoWindow({
      content: '<div class="marker-info">{{ block.settings.marker_info | escape }}</div>'
    });

    marker.addListener('click', () => {
      infoWindow.open(map, marker);
    });
    {% endif %}
    {% endif %}
  }

  function initializeSimpleMap{{ block.id | replace: '-', '' }}() {
    initSimpleMap('{{ block.id }}');
  }

  if (typeof google === 'undefined' && '{{ block.settings.google_maps_api_key }}' !== '') {
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key={{ block.settings.google_maps_api_key }}&callback=initializeSimpleMap{{ block.id | replace: '-', '' }}`;
    script.async = true;
    document.head.appendChild(script);
  } else if (typeof google !== 'undefined') {
    initSimpleMap('{{ block.id }}');
  }
</script>

<style>
  .map-display-block {
    margin: 2rem 0;
  }

  .map-title {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: {{ block.settings.title_color | default: '#333' }};
    text-align: {{ block.settings.title_alignment | default: 'left' }};
  }

  .map-description {
    margin-bottom: 1.5rem;
    color: {{ block.settings.text_color | default: '#666' }};
    text-align: {{ block.settings.text_alignment | default: 'left' }};
  }

  .map-wrapper {
    border-radius: {{ block.settings.border_radius }}px;
    overflow: hidden;
    {% if block.settings.show_shadow %}
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    {% endif %}
    {% if block.settings.border_width > 0 %}
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color | default: '#ddd' }};
    {% endif %}
  }

  .simple-map {
    width: 100%;
  }

  .map-error {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f8f8;
    color: #666;
    font-size: 1rem;
    height: 100%;
    min-height: 200px;
  }

  .marker-info {
    max-width: 200px;
    padding: 0.5rem;
  }
</style>

{% schema %}
{
  "name": "Map Display",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Our Location"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "google_maps_api_key",
      "label": "Google Maps API Key",
      "info": "Required for map functionality"
    },
    {
      "type": "text",
      "id": "latitude",
      "label": "Latitude",
      "default": "40.7128"
    },
    {
      "type": "text",
      "id": "longitude",
      "label": "Longitude",
      "default": "-74.0060"
    },
    {
      "type": "range",
      "id": "zoom",
      "label": "Zoom Level",
      "min": 1,
      "max": 20,
      "step": 1,
      "default": 12
    },
    {
      "type": "range",
      "id": "height",
      "label": "Map Height (px)",
      "min": 200,
      "max": 800,
      "step": 50,
      "default": 400
    },
    {
      "type": "checkbox",
      "id": "show_marker",
      "label": "Show Marker",
      "default": true
    },
    {
      "type": "text",
      "id": "marker_title",
      "label": "Marker Title",
      "default": "Our Location"
    },
    {
      "type": "textarea",
      "id": "marker_info",
      "label": "Marker Info Window Content"
    },
    {
      "type": "checkbox",
      "id": "show_map_type_control",
      "label": "Show Map Type Control",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_street_view_control",
      "label": "Show Street View Control",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_fullscreen_control",
      "label": "Show Fullscreen Control",
      "default": true
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#666666"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_shadow",
      "label": "Show Shadow",
      "default": true
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border Width (px)",
      "min": 0,
      "max": 10,
      "step": 1,
      "default": 0
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#dddddd"
    }
  ]
}
{% endschema %}